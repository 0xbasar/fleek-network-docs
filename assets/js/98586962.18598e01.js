"use strict";(self.webpackChunkdocta=self.webpackChunkdocta||[]).push([[6567],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>k});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(r),c=a,k=d["".concat(l,".").concat(c)]||d[c]||h[c]||o;return r?n.createElement(k,i(i({ref:t},p),{},{components:r})):n.createElement(k,i({ref:t},p))}));function k(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=r[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},1265:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=r(7462),a=(r(7294),r(3905)),o=r(3872);const i={template:"post",draft:!1,hide_title:!0,title:"Securing the Ursa files",slug:"securing-the-ursa-files",image:"./assets/fleek-network-securing-the-ursa-files.png?202302161437",date:new Date("2023-02-16T23:00:00.000Z"),canonical:"",description:"The concept of file permissions and ownership is crucial in preventing private or sensitive data from being exposed to dodgy actors. In this guide, we will explain Linux file permissions and ownership to help us improve the security of our Network Node server.",category:"Tutorial",tags:["CDN","Guide","Getting Started","Fleek Network","Security"]},s=void 0,l={unversionedId:"Network nodes/fleek-network-securing-the-ursa-files",id:"Network nodes/fleek-network-securing-the-ursa-files",title:"Securing the Ursa files",description:"The concept of file permissions and ownership is crucial in preventing private or sensitive data from being exposed to dodgy actors. In this guide, we will explain Linux file permissions and ownership to help us improve the security of our Network Node server.",source:"@site/guides/Network nodes/fleek-network-securing-the-ursa-files.md",sourceDirName:"Network nodes",slug:"/Network nodes/securing-the-ursa-files",permalink:"/guides/Network nodes/securing-the-ursa-files",draft:!1,editUrl:"https://github.com/fleek-network/fleek-network-docs/edit/main/guides/Network nodes/fleek-network-securing-the-ursa-files.md",tags:[{label:"CDN",permalink:"/guides/tags/cdn"},{label:"Guide",permalink:"/guides/tags/guide"},{label:"Getting Started",permalink:"/guides/tags/getting-started"},{label:"Fleek Network",permalink:"/guides/tags/fleek-network"},{label:"Security",permalink:"/guides/tags/security"}],version:"current",lastUpdatedAt:1677151851,formattedLastUpdatedAt:"Feb 23, 2023",frontMatter:{template:"post",draft:!1,hide_title:!0,title:"Securing the Ursa files",slug:"securing-the-ursa-files",image:"./assets/fleek-network-securing-the-ursa-files.png?202302161437",date:"2023-02-16T23:00:00.000Z",canonical:"",description:"The concept of file permissions and ownership is crucial in preventing private or sensitive data from being exposed to dodgy actors. In this guide, we will explain Linux file permissions and ownership to help us improve the security of our Network Node server.",category:"Tutorial",tags:["CDN","Guide","Getting Started","Fleek Network","Security"]},sidebar:"defaultSidebar",previous:{title:"Securing a node with SSL/TLS",permalink:"/guides/Network nodes/fleek-network-securing-a-node-with-ssl-tls"}},u={image:r(2189).Z},p=[{value:"Introduction",id:"introduction",level:2},{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Why should I care?",id:"why-should-i-care",level:2},{value:"How do I know if my system is vulnerable?",id:"how-do-i-know-if-my-system-is-vulnerable",level:2},{value:"Securing the Ursa home directory",id:"securing-the-ursa-home-directory",level:2},{value:"What&#39;s the relation with running the node?",id:"whats-the-relation-with-running-the-node",level:3},{value:"Stopping the Network Node",id:"stopping-the-network-node",level:3},{value:"Group existence checkups",id:"group-existence-checkups",level:3},{value:"Create a new user for running the node",id:"create-a-new-user-for-running-the-node",level:2},{value:"Things to have in mind",id:"things-to-have-in-mind",level:3},{value:"Move the Ursa source to the new user&#39;s home",id:"move-the-ursa-source-to-the-new-users-home",level:3},{value:"Changing Ursa files ownership",id:"changing-ursa-files-ownership",level:3},{value:"Quick health-check",id:"quick-health-check",level:3},{value:"How to check if the Ursa directories are secured?",id:"how-to-check-if-the-ursa-directories-are-secured",level:2},{value:"Final Thoughts",id:"final-thoughts",level:2}],d={toc:p};function h(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,n.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Fleek Network: Getting started guide",src:r(2189).Z,width:"2400",height:"1256"})),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"The concept of file permissions and ownership is crucial in preventing private or ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Information_sensitivity"},"sensitive data")," from being exposed to dodgy actors. In this guide, we will explain Linux file permissions and ownership to help us improve the security of our Network Node server."),(0,a.kt)("p",null,"Our Ursa CLI process is run by a ",(0,a.kt)("inlineCode",{parentName:"p"},"user"),", that has some sort of permissions, some users run it as ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," which should be considered, as ",(0,a.kt)("inlineCode",{parentName:"p"},"root privileges")," are not a necessary good."),(0,a.kt)("p",null,"Let's discuss the topic and open up a few ideas to help us improve the security of our server!"),(0,a.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,a.kt)("p",null,"To follow the guide, you will need the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Familiarity with the command-line interface"),(0,a.kt)("li",{parentName:"ul"},"A supported Linux Server Operating system",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Ubuntu (22.04 LTS), or earlier"),(0,a.kt)("li",{parentName:"ul"},"Debian (version 11), or earlier"),(0,a.kt)("li",{parentName:"ul"},"ArchLinux, which has rolling updates."))),(0,a.kt)("li",{parentName:"ul"},"Ursa Network Node installed and running correctly")),(0,a.kt)("h2",{id:"why-should-i-care"},"Why should I care?"),(0,a.kt)("p",null,"You should be interested in securing the server, to prevent unwanted access to sensitive data, for instance, your identity (private keys) to which the rewards are sent!"),(0,a.kt)("p",null,"This can happen in many ways, but if you follow good practices you can reduce some of the risks managing the server where the Ursa Network Node is run."),(0,a.kt)("p",null,"A Linux server is a multi-user system that uses permissions and ownership has security. By allowing multiple users into a system, trust has to be thought out! There should be a way to control file permissions, naming who's allowed to access what, and in which locations."),(0,a.kt)("p",null,"Ideally, you should be the only actor who can read or modify the private keys. The processes or programs installed should not be able to read your private files without permission. For example, if you run a random script from the internet, as ",(0,a.kt)("inlineCode",{parentName:"p"},"root"),", and if the script is maliciously targeting Fleek Network node operators, your identity and private data can be compromised. There'll be no one to help you or blame than yourself!"),(0,a.kt)("p",null,"As the ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Wu-Tang_Clan"},"Wu-Tang")," once rapped about ",(0,a.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=1_-3Bh1VFI8"},'"Protect ya neck"'),"."),(0,a.kt)("h2",{id:"how-do-i-know-if-my-system-is-vulnerable"},"How do I know if my system is vulnerable?"),(0,a.kt)("p",null,"If you are running the Docker Stack, or the Ursa CLI, as the ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," user, your file permissions are likely in need of good care."),(0,a.kt)("p",null,"On the other hand, if you have questions, or are curious, about where your identity (private keys) is kept and don't know how to improve the security of the files, then this is a good start! You'll also find our guide about ",(0,a.kt)("a",{parentName:"p",href:"/guides/Network%20nodes/fleek-network-managing-the-key-store"},"Managing the key store")," a good read."),(0,a.kt)("p",null,"There's also a section in this about ",(0,a.kt)("a",{parentName:"p",href:"#how-to-check-if-the-ursa-directories-are-secured"},"How to check if the Ursa directories are secured")),(0,a.kt)("h2",{id:"securing-the-ursa-home-directory"},"Securing the Ursa home directory"),(0,a.kt)("p",null,"We'll look into securing access to the ",(0,a.kt)("inlineCode",{parentName:"p"},"$HOME/.ursa")," directory, where sensitive data, such as the identity is stored. Providing control to specific users or groups helps prevent unwanted access to private files. Don't trust, verify!"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'"Trust leads to the dark side." - Obi Wan Kenobi')),(0,a.kt)("p",null,"\ud83d\udca1 For our example, we are sticking with Ubuntu, do the equivalent for your OS. We'll assume that you are login as ",(0,a.kt)("inlineCode",{parentName:"p"},"root"),", to emphasize our goal. Additionally, we're going to use the Docker Stack, but it should be similar even if you have Ursa installed natively, but you'll have to do the required tweaks accordingly."),(0,a.kt)("h3",{id:"whats-the-relation-with-running-the-node"},"What's the relation with running the node?"),(0,a.kt)("p",null,"Before we get started, let's look at how the ",(0,a.kt)("inlineCode",{parentName:"p"},"Docker")," daemon works! Your container runs one single process. The process runs as a ",(0,a.kt)("inlineCode",{parentName:"p"},"UID:GID")," (User:Group), just like any other process on your system. We should set the permissions on the directory we bind mount accordingly! "),(0,a.kt)("p",null,"This means that the same principle is applied if running the Node natively! In other words, there is nothing special about this process running in the container - treat it as if it wasn't!"),(0,a.kt)("p",null,"By default, ",(0,a.kt)("inlineCode",{parentName:"p"},"Docker")," daemon runs as the ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," user, the ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," user has full control of the system and has the power to do some nasty things if not careful. You can run Docker daemon without root (Rootless mode) and docker provides ",(0,a.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/security/rootless/"},"documentation")," about it. "),(0,a.kt)("p",null,"For our use-case, we want to run the Docker Stack as a non-administrative user (lower permissions in the system), as our service is meant to be run with non-root privileges, and ideally, only elevate their privileges to modify the underlying system when authorized. In any case, be aware that even if you can start the docker daemon without root, you'd still have the ability to start our Docker Stack with root, which is something we want you to avoid doing, as it's not necessary."),(0,a.kt)("h3",{id:"stopping-the-network-node"},"Stopping the Network Node"),(0,a.kt)("p",null,"Before going any further, let's stop the Docker Stack (a must, if you have started the Fleek Network Ursa Docker Stack with ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," user). If you're following while running in a native setup, you need to stop the ",(0,a.kt)("inlineCode",{parentName:"p"},"ursa cli")," process, as mentioned earlier we'll stick with the Docker stack as an example, so apply the required tweaks where needed."),(0,a.kt)("p",null,"Change the directory to the Ursa repository (by default, located in ",(0,a.kt)("inlineCode",{parentName:"p"},"$HOME/fleek-network/ursa"),")."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker compose -f ./docker/full-node/docker-compose.yml down\n")),(0,a.kt)("p",null,"Afterward, we'll run the Docker Stack as a new user with non-root privileges."),(0,a.kt)("h3",{id:"group-existence-checkups"},"Group existence checkups"),(0,a.kt)("p",null,"Start by checking if the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," group exists in the system by running the following command (if the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker"),' group exists, you should get the response "\ud83e\udd73 Docker group exists!").'),(0,a.kt)("p",null,"\ud83d\udca1 If you are following this guide while running a native build, you don't need a ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," group, but you might consider creating a group meant to manage and run the Ursa process, you can name it whatever is more meaningful to you. We'll stick with the Docker Stack setup as an example, and apply the required tweaks where necessary."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"cat /etc/group | grep 'docker' > /dev/null  && echo \"\ud83e\udd73 Docker group exists!\"\n")),(0,a.kt)("p",null,"If not, create the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," group."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"sudo groupadd docker\n")),(0,a.kt)("h2",{id:"create-a-new-user-for-running-the-node"},"Create a new user for running the node"),(0,a.kt)("p",null,"Add a new user with the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"sudo adduser <YOUR-USERNAME>\n")),(0,a.kt)("p",null,"For our example, we'll name it ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker")," but you can choose any other name:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"sudo adduser skywalker\n")),(0,a.kt)("p",null,"Let's add the user ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker")," to the docker group:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"sudo usermod -aG docker skywalker\n")),(0,a.kt)("p",null,"\u26a0\ufe0f If you are following this guide on a native setup, you won't need a ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," group, but another group of your liking might apply. Make the required tweaks as necessary, as we'll stick with Docker Stack as an example."),(0,a.kt)("p",null,"\ud83d\udca1 You may have to restart the Docker daemon (which requires ",(0,a.kt)("inlineCode",{parentName:"p"},"sudo")," if you are not ",(0,a.kt)("inlineCode",{parentName:"p"},"root"),")."),(0,a.kt)("p",null,"###\xa0Restart the docker daemon"),(0,a.kt)("p",null,"Run the ",(0,a.kt)("inlineCode",{parentName:"p"},"stop")," and then ",(0,a.kt)("inlineCode",{parentName:"p"},"start")," commands."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"systemctl stop docker\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"systemctl start docker\n")),(0,a.kt)("p",null,"From now on, the user ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker")," will have the ability to ",(0,a.kt)("inlineCode",{parentName:"p"},"up")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"down")," the Docker Stack without ",(0,a.kt)("inlineCode",{parentName:"p"},"sudo"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"# Change directory to where Ursa repository is stored\n# by default `$HOME/fleek-network/ursa`\n# e.g., if you've installed as user `root` it'll be located\n# in `/home/root/fleek-network/ursa` by default\n# after switching user you'd have to `mv` or `reinstall`\n# to have it in the /home/username/fleek-network/ursa path\ncd $HOME/fleek-network/ursa\n\n# The `down` command\ndocker compose -f ./docker/full-node/docker-compose.yml down\n\n# The `up` command\ndocker compose -f ./docker/full-node/docker-compose.yml up\n")),(0,a.kt)("h3",{id:"things-to-have-in-mind"},"Things to have in mind"),(0,a.kt)("p",null,"Here are a few things to have in mind - there are more -, but these are the ones that came to mind at the time of writing (feel free to contribute or provide feedback):"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Our recommendation is to keep the user ",(0,a.kt)("inlineCode",{parentName:"li"},"skywalker")," from the ",(0,a.kt)("inlineCode",{parentName:"li"},"sudoers")," list, as a proper Jedi, we separate ourselves from the dark forces"),(0,a.kt)("li",{parentName:"ul"},"Advanced users might customize their system as they wish, here we try to provide knowledge for the inclusivity of all kinds of knowledge users"),(0,a.kt)("li",{parentName:"ul"},"You should NOT run the Fleek Network Stack with ",(0,a.kt)("inlineCode",{parentName:"li"},"root")," privilege"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sudo")," allows users to execute system commands with ",(0,a.kt)("inlineCode",{parentName:"li"},"root")," privilege"),(0,a.kt)("li",{parentName:"ul"},"A user in the ",(0,a.kt)("inlineCode",{parentName:"li"},"sudoer")," list can do whatever he wants in the system"),(0,a.kt)("li",{parentName:"ul"},"Do not trust users e.g., anyone might run a script or command that exposes or compromises your private keys located in ",(0,a.kt)("inlineCode",{parentName:"li"},"$HOME/.ursa/keystore")),(0,a.kt)("li",{parentName:"ul"},"Users who logged in as ",(0,a.kt)("inlineCode",{parentName:"li"},"root")," during the installation, most likely have it installed under ",(0,a.kt)("inlineCode",{parentName:"li"},"/home/root/fleek-network/ursa"),", meaning that when switching users have to move the ",(0,a.kt)("inlineCode",{parentName:"li"},"fleek-network")," directory to ",(0,a.kt)("inlineCode",{parentName:"li"},"$HOME/fleek-network")," or reinstall")),(0,a.kt)("h3",{id:"move-the-ursa-source-to-the-new-users-home"},"Move the Ursa source to the new user's home"),(0,a.kt)("p",null,"Since we are logged in as, installed as, and running as ",(0,a.kt)("inlineCode",{parentName:"p"},"root"),", our Ursa repository is stored in the ",(0,a.kt)("inlineCode",{parentName:"p"},"$HOME/fleek-network")," by default, which ",(0,a.kt)("inlineCode",{parentName:"p"},"$HOME")," for ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," is ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/root"),". The user ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker")," won't have permission to read, write or execute in or from the directory. We'll then either, reinstall the Ursa using our assisted installer after we switch the user to ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker"),", or move ",(0,a.kt)("inlineCode",{parentName:"p"},"mv")," the directories beforehand."),(0,a.kt)("p",null,"We're going to opt to move the directories, as an example but if you have a preference for running the assisted installer, that's fine! Do remember to remove or delete the ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/root/fleek-network")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/root/.ursa")," (\u26a0\ufe0f be careful, the ",(0,a.kt)("inlineCode",{parentName:"p"},".ursa")," directory has your private keys, so do a backup otherwise you'll lose it and we won't be able to help)."),(0,a.kt)("p",null,"\ud83d\udca1 Notice that we are using the default ",(0,a.kt)("inlineCode",{parentName:"p"},"$HOME/fleek-network/ursa")," path, you may have installed it in a different location, so tweak it accordingly to your customizations"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"mv /home/root/fleek-network /home/skywalker/\n")),(0,a.kt)("p",null,"This is how the directory ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/skywalker/fleek-network")," looks like at the time of writing:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"/home/skywalker/fleek-network/\n\u2514\u2500\u2500 ursa\n    \u251c\u2500\u2500 CODE_OF_CONDUCT.md\n    \u251c\u2500\u2500 Cargo.toml\n    \u251c\u2500\u2500 Dockerfile\n    \u251c\u2500\u2500 Dockerfile-gateway\n    \u251c\u2500\u2500 LICENSE-APACHE\n    \u251c\u2500\u2500 LICENSE-MIT\n    \u251c\u2500\u2500 Makefile\n    \u251c\u2500\u2500 README.md\n    \u251c\u2500\u2500 crates\n    \u251c\u2500\u2500 doc\n    \u251c\u2500\u2500 docker\n    \u251c\u2500\u2500 fly.toml\n    \u251c\u2500\u2500 infra\n    \u251c\u2500\u2500 rust-toolchain.toml\n    \u251c\u2500\u2500 sdk\n    \u251c\u2500\u2500 test-plans\n    \u2514\u2500\u2500 test_files\n")),(0,a.kt)("p",null,"We do the same for ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/root/.ursa")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"mv /home/root/.ursa /home/skywalker/\n")),(0,a.kt)("p",null,"This is what the directory ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/skywalker/.ursa")," looks like at the time of writing:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"/home/skywalker/.ursa/\n\u251c\u2500\u2500 config.toml\n\u251c\u2500\u2500 data\n\u2502\xa0\xa0 \u251c\u2500\u2500 index_provider_db\n\u2502\xa0\xa0 \u2514\u2500\u2500 ursa_db\n\u2514\u2500\u2500 keystore\n    \u2514\u2500\u2500 default.pem\n")),(0,a.kt)("h3",{id:"changing-ursa-files-ownership"},"Changing Ursa files ownership"),(0,a.kt)("p",null,"We haven't yet switched from ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker"),", so before we switch from ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker"),", we're going to change the owner of the ",(0,a.kt)("inlineCode",{parentName:"p"},"$HOME/.ursa")," directory, where sensitive data is located (in particular the private identity keys)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"chown -R skywalker:skywalker /home/skywalker/.ursa\n")),(0,a.kt)("p",null,"Including, changing permissions for the directory ",(0,a.kt)("inlineCode",{parentName:"p"},"$HOME/.ursa")," and files recursively (the parent and nested child directories and files), granting read, write and execute permissions for the user ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker")," and group ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"chmod -R u+rwx /home/skywalker/.ursa\n")),(0,a.kt)("p",null,"Following up, we say ",(0,a.kt)("strong",{parentName:"p"},"g")," ",(0,a.kt)("inlineCode",{parentName:"p"},"group")," and ",(0,a.kt)("strong",{parentName:"p"},"o")," ",(0,a.kt)("inlineCode",{parentName:"p"},"other")," should ",(0,a.kt)("strong",{parentName:"p"},"NOT")," have ",(0,a.kt)("strong",{parentName:"p"},"r"),"ead, ",(0,a.kt)("strong",{parentName:"p"},"w"),"rite and ",(0,a.kt)("strong",{parentName:"p"},"e"),"xecute permissions for ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/skywalker/.ursa"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"chmod -R go-rwx /home/skywalker/.ursa\n")),(0,a.kt)("p",null,"Alternatively, you can do ",(0,a.kt)("inlineCode",{parentName:"p"},"chmod -R 700 /home/skywalker/.ursa"),", but as we are aiming for clarity in the instructions, we opted for the clearest option to suit more users."),(0,a.kt)("p",null,"###\xa0Switching to the non-administrative user"),(0,a.kt)("p",null,"Finally, we switch to the user ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"su skywalker\n")),(0,a.kt)("p",null,"Change the directory to the ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker")," Ursa's source repository path:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"cd $HOME/fleek-network/ursa\n")),(0,a.kt)("p",null,"###\xa0Start Ursa as the non-administrative user"),(0,a.kt)("p",null,"Start the Docker Stack as ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker")," by executing the following command that you should be familiar with at this point:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker compose -f ./docker/full-node/docker-compose.yml up\n")),(0,a.kt)("p",null,"\ud83d\udca1 Use the flag ",(0,a.kt)("inlineCode",{parentName:"p"},"-d")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"--detach")," at the end to start the Docker Stack in ",(0,a.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/commandline/compose_up/"},"detached mode")," if you'd like to run the containers in the background (meaning that the process does NOT communicate via the screen and the keyboard, e.g., avoid displaying the log output which can be enabled at any time with ",(0,a.kt)("inlineCode",{parentName:"p"},"logs -f"),")"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"docker compose -f ./docker/full-node/docker-compose.yml up --detach\n")),(0,a.kt)("h3",{id:"quick-health-check"},"Quick health-check"),(0,a.kt)("p",null,"Make sure everything's ok by doing a quick health check. If you'd like to learn more about health checks, check our guide ",(0,a.kt)("a",{parentName:"p",href:"/guides/Network%20nodes/fleek-network-node-health-check-guide"},"here"),"."),(0,a.kt)("p",null,"You can do this check in any location, but ideally from outside the server network to ensure you're making a remote call"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"curl https://YOUR-DOMAIN-NAME/ping\n")),(0,a.kt)("p",null,"Should reply with the response ",(0,a.kt)("inlineCode",{parentName:"p"},"pong")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"pong\n")),(0,a.kt)("p",null,"\ud83e\udee1 That's it skywalker! If you've followed this guide successfully, you've secured the ",(0,a.kt)("inlineCode",{parentName:"p"},".ursa")," directory, the configuration files and your private keys."),(0,a.kt)("h2",{id:"how-to-check-if-the-ursa-directories-are-secured"},"How to check if the Ursa directories are secured?"),(0,a.kt)("p",null,"It's a good practice to verify the health of your setup from time to time. Doing a permissions checkup on the file system gives you peace of mind and helps ensure that sensitive data is protected."),(0,a.kt)("p",null,"\u26a0\ufe0f You're required to have followed the steps before to secure the ",(0,a.kt)("inlineCode",{parentName:"p"},".ursa")," configuration directory and also run the Node as non-root. If you haven't yet, follow the steps provided ",(0,a.kt)("a",{parentName:"p",href:"#securing-the-ursa-home-directory"},"here"),"."),(0,a.kt)("p",null,"We're using the example username ",(0,a.kt)("inlineCode",{parentName:"p"},"skywalker"),", change to the one you've used on your setup accordingly."),(0,a.kt)("p",null,"Use the ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Ls"},"ls")," command to list information about the files. For example, we can check the parent directory with ",(0,a.kt)("inlineCode",{parentName:"p"},"ls")," and the ",(0,a.kt)("inlineCode",{parentName:"p"},"l")," flag."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"ls -l /home/skywalker/.ursa\n")),(0,a.kt)("p",null,"You can keep inspecting the nested directories but it's quite a lot of labor."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"total 12\n-rwx------ 1 skywalker skywalker  687 Feb 15 18:24 config.toml\ndrwx------ 4 skywalker skywalker 4096 Feb 15 18:24 data\ndrwx------ 2 skywalker skywalker 4096 Feb 15 18:24 keystore\n")),(0,a.kt)("p",null,"You can check all the directories and files recursively if you wish. For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"find $HOME/.ursa -printf '%M %u %g %p\\n' | less\n")),(0,a.kt)("p",null,"You can exclude certain directories, for example, let's filter out the ",(0,a.kt)("inlineCode",{parentName:"p"},".ursa/data")," directory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"find $HOME/.ursa -printf '%M %u %g %p\\n' | grep -v \"$HOME/.ursa/data\" | less\n")),(0,a.kt)("p",null,"Here's what the output looks like at the time of writing:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"drwx------ skywalker skywalker /home/skywalker/.ursa\n-rwx------ skywalker skywalker /home/skywalker/.ursa/config.toml\ndrwx------ skywalker skywalker /home/skywalker/.ursa/keystore\n-rwx------ skywalker skywalker /home/skywalker/.ursa/keystore/default.pem\n")),(0,a.kt)("p",null,"In the outputs, we can see the ",(0,a.kt)("inlineCode",{parentName:"p"},"UID:GID")," (user:group) identifiers and also in the left bit the permissions that are set."),(0,a.kt)("p",null,"\ud83e\udd14 Try to read it this way, the first character is the file type while the remaining is the access permissions."),(0,a.kt)("p",null,"For ",(0,a.kt)("inlineCode",{parentName:"p"},"drwx------"),", the ",(0,a.kt)("inlineCode",{parentName:"p"},"d")," represents a directory, when not ",(0,a.kt)("inlineCode",{parentName:"p"},"-")," means ",(0,a.kt)("inlineCode",{parentName:"p"},"file"),", we then have ",(0,a.kt)("inlineCode",{parentName:"p"},"rwx")," for read, write and execute for section ",(0,a.kt)("inlineCode",{parentName:"p"},"user"),"."),(0,a.kt)("p",null,"Notice that after, ",(0,a.kt)("inlineCode",{parentName:"p"},"------")," there's nothing set for ",(0,a.kt)("inlineCode",{parentName:"p"},"group")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"other"),". In short (file type)(user permissions)(group permissions)(other permissions). "),(0,a.kt)("p",null,"Also, remember that the group may have permissions, and when a user is added to the group it'll inherit those permissions."),(0,a.kt)("h2",{id:"final-thoughts"},"Final Thoughts"),(0,a.kt)("p",null,"We started by declaring that is crucial to learn about Linux file permissions and ownership, to improve the security of our server, also protect sensitive data from being captured by malicious actors."),(0,a.kt)("p",null,"Used the Docker Stack for guidance, where we instruct how to start it without ",(0,a.kt)("inlineCode",{parentName:"p"},"sudo"),", learned how to create a new user and groups, and change ownership and permissions in the file system, including the ",(0,a.kt)("inlineCode",{parentName:"p"},".ursa")," configuration files where the identity or private keys are stored."),(0,a.kt)("p",null,"Finally, completed our guide by demonstrating how to check if the Ursa directories are secured by providing some command examples and a description to help understand the attributes that describe the file types and permissions."),(0,a.kt)("p",null,"The guide serves as a getting started in the subject and in any way tries to fulfill the role of granting the ultimate security of the server. For advanced topics in securing a Linux server, it's best to invest time and better resources which is not possible in the scope of this short guide: the knowledge of Linux security is applicable in the context of running a Fleek Network node."),(0,a.kt)("p",null,"If you'd like to contribute and share your knowledge you are free to do so by providing us a PR in our repository ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/fleek-network-docs"},"here"),"."),(0,a.kt)("p",null,"Discover more about the project by ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa"},"watching/contributing on Github"),", following us on ",(0,a.kt)("a",{parentName:"p",href:"https://twitter.com/fleek_net"},"Twitter"),", and joining ",(0,a.kt)("a",{parentName:"p",href:"https://discord.gg/fleekxyz"},"our community Discord")," for all the best updates!"),(0,a.kt)(o.Z,{name:"Helder Oliveira",image:"https://github.com/heldrida.png",title:"Software Developer + DX",url:"https://github.com/heldrida",mdxType:"Author"}))}h.isMDXComponent=!0},3872:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(7294);const a=e=>{let{image:t,name:r,title:a,url:o}=e;return n.createElement("section",{className:"author_card"},n.createElement("div",null,n.createElement("span",{className:"avatar"},n.createElement("a",{href:o,target:"_blank",alt:r},n.createElement("img",{src:t,alt:r}))),n.createElement("div",null,n.createElement("span",{className:"name"},n.createElement("a",{href:o,target:"_blank",alt:r},r)),n.createElement("span",{className:"title"},a),n.createElement("span",{className:"discord"},"Got questions? Find us on ",n.createElement("a",{href:"https://discord.gg/fleekxyz",target:"_blank"},"Discord!")))))}},2189:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/fleek-network-securing-the-ursa-files-37ef93b46f3ad43736c93651b23797a6.png"}}]);