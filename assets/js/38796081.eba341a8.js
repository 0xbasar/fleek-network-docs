"use strict";(self.webpackChunkdocta=self.webpackChunkdocta||[]).push([[6655],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||o;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3826:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var a=n(7462),r=(n(7294),n(3905)),o=n(1026),i=n(3872);n(4456);const s={template:"post",draft:!1,hide_title:!0,title:"Securing a node with SSL/TLS",slug:"fleek-network-securing-a-node-with-ssl-tls",image:"./assets/fleek-network-how-to-secure-a-network-node.png?202301261536",date:new Date("2023-01-24T09:30:00.000Z"),canonical:"",description:"We'll look into how to secure a Fleek Node with TLS certificates provided by Let's Encrypt, the nonprofit Certificate Authority (CA) used in the Docker stack",category:"Tutorial",tags:["DCDN","Guide","Getting Started","Fleek Network","security","SSL/TSL","Let's Encrypt","Certbot","Docker"]},l=void 0,c={unversionedId:"Network nodes/fleek-network-securing-a-node-with-ssl-tls",id:"Network nodes/fleek-network-securing-a-node-with-ssl-tls",title:"Securing a node with SSL/TLS",description:"We'll look into how to secure a Fleek Node with TLS certificates provided by Let's Encrypt, the nonprofit Certificate Authority (CA) used in the Docker stack",source:"@site/guides/Network nodes/fleek-network-securing-a-node-with-ssl-tls.md",sourceDirName:"Network nodes",slug:"/Network nodes/fleek-network-securing-a-node-with-ssl-tls",permalink:"/guides/Network nodes/fleek-network-securing-a-node-with-ssl-tls",draft:!1,editUrl:"https://github.com/fleek-network/fleek-network-docs/edit/main/guides/Network nodes/fleek-network-securing-a-node-with-ssl-tls.md",tags:[{label:"DCDN",permalink:"/guides/tags/dcdn"},{label:"Guide",permalink:"/guides/tags/guide"},{label:"Getting Started",permalink:"/guides/tags/getting-started"},{label:"Fleek Network",permalink:"/guides/tags/fleek-network"},{label:"security",permalink:"/guides/tags/security"},{label:"SSL/TSL",permalink:"/guides/tags/ssl-tsl"},{label:"Let's Encrypt",permalink:"/guides/tags/lets-encrypt"},{label:"Certbot",permalink:"/guides/tags/certbot"},{label:"Docker",permalink:"/guides/tags/docker"}],version:"current",lastUpdatedAt:1683714666,formattedLastUpdatedAt:"May 10, 2023",frontMatter:{template:"post",draft:!1,hide_title:!0,title:"Securing a node with SSL/TLS",slug:"fleek-network-securing-a-node-with-ssl-tls",image:"./assets/fleek-network-how-to-secure-a-network-node.png?202301261536",date:"2023-01-24T09:30:00.000Z",canonical:"",description:"We'll look into how to secure a Fleek Node with TLS certificates provided by Let's Encrypt, the nonprofit Certificate Authority (CA) used in the Docker stack",category:"Tutorial",tags:["DCDN","Guide","Getting Started","Fleek Network","security","SSL/TSL","Let's Encrypt","Certbot","Docker"]},sidebar:"defaultSidebar",previous:{title:"Running a node in a Docker container",permalink:"/guides/Network nodes/fleek-network-running-a-node-in-a-docker-container"},next:{title:"Securing the Ursa files",permalink:"/guides/Network nodes/securing-the-ursa-files"}},p={image:n(8635).Z},d=[{value:"Introduction",id:"introduction",level:2},{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"What are SSL/TLS certificates?",id:"what-are-ssltls-certificates",level:2},{value:"Why secure the Network Node?",id:"why-secure-the-network-node",level:2},{value:"Why is a domain name required?",id:"why-is-a-domain-name-required",level:2},{value:"Where to get a domain name?",id:"where-to-get-a-domain-name",level:2},{value:"Can I use an ENS domain?",id:"can-i-use-an-ens-domain",level:2},{value:"Domain name setup",id:"domain-name-setup",level:2},{value:"How to set up the DNS settings for a Node server?",id:"how-to-set-up-the-dns-settings-for-a-node-server",level:3},{value:"Alternatively, how can one get a free domain name for testing?",id:"alternatively-how-can-one-get-a-free-domain-name-for-testing",level:3},{value:"How to verify DNS records?",id:"how-to-verify-dns-records",level:3},{value:"Stack Services",id:"stack-services",level:2},{value:"Ursa-proxy SSL/TLS configuration",id:"ursa-proxy-ssltls-configuration",level:2},{value:"Creating a valid certificate",id:"creating-a-valid-certificate",level:3},{value:"Preparing the Certbot initialization",id:"preparing-the-certbot-initialization",level:3},{value:"Running the Let&#39;s Encrypt automation script",id:"running-the-lets-encrypt-automation-script",level:3},{value:"How to run a domain name health check?",id:"how-to-run-a-domain-name-health-check",level:3},{value:"Conclusion",id:"conclusion",level:2}],u={toc:d};function h(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(8557).Z,width:"2400",height:"1256"})),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Secure Sockets Layer or Transport Layer Security are the technologies used to keep an internet connection secure by protecting sensitive data that is transferred between systems. It's a protocol for servers and web clients to ensure that data passed between them is private!"),(0,r.kt)("p",null,"A secure connection is required to prevent others from modifying, reading or tampering with the data that is transmitted. Otherwise, it can be intercepted by third parties, such as hackers.\nHTTP connections are insecure by default. SSL, or TLS (the modern version of SSL), uses advanced encryption algorithms in transit, keeping the data transferred over the connection private."),(0,r.kt)("p",null,"You've likely noticed ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTPS://")," when surfing the web, and more specifically when making payments or dealing with sensitive data! This is used to secure and encrypt the connection."),(0,r.kt)("p",null,"Nonetheless, accessing a service via ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTPS://")," does not make it secure, as the SSL/TLS requires a valid certificate that is processed by a ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Certificate_authority"},"Certificate Authority (CA)"),". Historically, SSL/TLS Certificates are usually purchased from a retailer that acts as a Certificate Authority (CA), known to be costly and especially when setting up multiple web services!"),(0,r.kt)("p",null,"In recent years, the non-profit organization ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Let's_Encrypt"},"Let's Encrypt")," started providing TLS certificate encryption, that is free of charge. The Let's Encrypt organization also improved the administration experience by providing automation features for system administrator processes."),(0,r.kt)("p",null,"In that respect, we'll look into how to secure a Fleek Node with TLS certificates provided by Let's Encrypt, by harnessing the knowledge provided in our ",(0,r.kt)("a",{parentName:"p",href:"fleek-network-running-a-node-in-a-docker-container"},"Running a node in a Docker container")," guide. We'll look into how to set up our custom domain in the ursa-proxy configuration, generate dummy certificates, and finally real certificates to understand how the certificate automation is handled to mitigate issues, such as expiration."),(0,r.kt)("p",null,"The knowledge demonstrated here should be useful and can be easily applied to native setups (not Docker). As some troubleshooting and differences are found in different systems, we'll stick with our Docker Stack for that matter and simplicity!"),(0,r.kt)("p",null,"If you have any feedback or questions join ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/fleekxyz"},"our community Discord")," channel!"),(0,r.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,r.kt)("p",null,"To follow the guide, you will need the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Familiarity with the command-line interface ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Ability to run the Docker Stack successfully as instructed in our ",(0,r.kt)("a",{parentName:"p",href:"fleek-network-running-a-node-in-a-docker-container"},"Running a node in a Docker container")," or ",(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=uAFIDu3UBvw"},"video guide"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Have a domain name and DNS setup management permissions (ideally if you want to persist a domain for a long time, we'll provide you with a free alternative that is dynamic and only suitable for the demo)"),(0,r.kt)(o.ZP,{mdxType:"CheckoutCommitWarning"}))),(0,r.kt)("h2",{id:"what-are-ssltls-certificates"},"What are SSL/TLS certificates?"),(0,r.kt)("p",null,"An SSL Certificate is a file that is stored on a web server that represents the content of an encrypted key. A certificate file only contains information that is relevant to authenticate a service. Some of the properties of the file include a key pair (a public and private key that work together to establish an encrypted connection), the issuer of the certificate, and the associated subdomains."),(0,r.kt)("p",null,"In practice when a user navigates to a secure service, the user gets a public key, establishes an encrypted connection and has the server identity verified."),(0,r.kt)("p",null,"Nowadays, most web clients use TLS (Transport Layer Security) encryption, which is used as SSL (Secure Sockets Layer). Although should be noted that SSL certificates are predecessors of TLS (TLS is an improvement that evolved from SSL), however, the names TLS and SSL remain interchangeable as certificates!"),(0,r.kt)("h2",{id:"why-secure-the-network-node"},"Why secure the Network Node?"),(0,r.kt)("p",null,"Provide a form to authenticate the Network Node server, and without it, the end client that consumes the data is at higher risk of having transmitted data stolen. You want the ability to authenticate your Network Node!"),(0,r.kt)("p",null,"The secure HTTPS protocol is a norm, while HTTP is obsolete! A Fleek Network Node that is not secure may be punished for bad behavior and thus not be rewarded."),(0,r.kt)("p",null,"Since this is a serious web security vulnerability, ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Man-in-the-middle_attack"},"attackers can place themselves between")," the users' client and your Network Node server, and intercept sensitive data in transit."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You want to secure the server for better participation in the network and ensure good behavior, rewards, and global network security.")),(0,r.kt)("h2",{id:"why-is-a-domain-name-required"},"Why is a domain name required?"),(0,r.kt)("p",null,"A domain name is required to secure the communications. SSL/TLS by Let's Encrypt is used to improve the operator experience. Let's Encrypt makes it easy as possible for you by automating the process without cost."),(0,r.kt)("p",null,"Unfortunately, Let's Encrypt doesn't issue certificates for IP addresses, only domain names are supported."),(0,r.kt)("p",null,"For this reason, a domain name is required to get a Let's Encrypt certificate."),(0,r.kt)("p",null,"Advanced users might want to set up the node as they wish, for example, have their own SSL provider or even secure the IP address of their servers. But bear in mind, that is very likely that the reward mechanism and performance of your Node will be taken into account, so to avoid disappointment make the right choice and follow our recommendations."),(0,r.kt)("h2",{id:"where-to-get-a-domain-name"},"Where to get a domain name?"),(0,r.kt)("p",null,'We are not affiliated with any domain name registrar, so recommend getting a domain name at a reasonable cost. Some domain name registrars provide "cheap" registrations which have rather expensive renewals, so make sure you check the renewals before committing to registering a domain name.'),(0,r.kt)("h2",{id:"can-i-use-an-ens-domain"},"Can I use an ENS domain?"),(0,r.kt)("p",null,"ENS stands for Ethereum Name Service, and ENS domains are not supported. You're required to have a ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Domain_Name_System"},"DNS - Domain Name System")," web domain."),(0,r.kt)("h2",{id:"domain-name-setup"},"Domain name setup"),(0,r.kt)("p",null,"A domain name is required to follow the instructions, these can be registered by a domain registry provider such as ",(0,r.kt)("a",{parentName:"p",href:"https://www.opendomainregistry.net/"},"Open domain registry"),", ",(0,r.kt)("a",{parentName:"p",href:"https://www.gandi.net/en-GB"},"Gandi")," and many others! Some domain name registrars provide SSL certificates as an additional service, but we are going to create TLS certificates on our own, so you won't need the domain name registry provider SSL service for this guide!"),(0,r.kt)("p",null,"\ud83d\udca1 SSL without a domain is possible, but we are going to work with domain names to keep this guide simple. If you are looking into securing a public IP Address, you'll have to do it on your own or wait for a future guide!"),(0,r.kt)("p",null,"The domain name DNS records should point to the Network Node server IP address so that when the custom domain is requested, the DNS translates into the server IP address. Our reverse proxy will identify itself with the transport-layer authentication mechanism that includes the SSL certificates."),(0,r.kt)("h3",{id:"how-to-set-up-the-dns-settings-for-a-node-server"},"How to set up the DNS settings for a Node server?"),(0,r.kt)("p",null,"Create or update the ",(0,r.kt)("inlineCode",{parentName:"p"},"A record")," to point to the server IP Address."),(0,r.kt)("p",null,"As an example, let's say that we have a domain ",(0,r.kt)("inlineCode",{parentName:"p"},"fleek.xyz"),", where we set up a subdomain ",(0,r.kt)("inlineCode",{parentName:"p"},"fleek-network-node")," and that our server IP Address (where the Fleek Network Node is running from) is ",(0,r.kt)("inlineCode",{parentName:"p"},"181.196.118.156"),"."),(0,r.kt)("p",null,"The custom domain address would be:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"fleek-network-node.fleek.xyz\n")),(0,r.kt)("p",null,"\ud83d\udca1 Keep a note about the domain name as it'll be required for your reverse proxy configuration."),(0,r.kt)("p",null,"Our server IP Address (this should be public, accessible outside the private network, otherwise external Nodes won't be able to communicate):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"181.196.118.156\n")),(0,r.kt)("p",null,'Depending on the "domain name registry" dashboard, you\'d have to update the ',(0,r.kt)("inlineCode",{parentName:"p"},"A Records"),", here's an example:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Host"),(0,r.kt)("th",{parentName:"tr",align:null},"Answer"),(0,r.kt)("th",{parentName:"tr",align:null},"TTL"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"A"),(0,r.kt)("td",{parentName:"tr",align:null},"fleek-network-node.fleek.xyz"),(0,r.kt)("td",{parentName:"tr",align:null},"181.196.118.156"),(0,r.kt)("td",{parentName:"tr",align:null},"300")))),(0,r.kt)("p",null,"Learn more about record types ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/List_of_DNS_record_types"},"here"),"."),(0,r.kt)("p",null,"DNS changes may take some time to propagate, thus make sure to ",(0,r.kt)("a",{parentName:"p",href:"#how-to-verify-dns-records"},"verify the DNS records"),"."),(0,r.kt)("h3",{id:"alternatively-how-can-one-get-a-free-domain-name-for-testing"},"Alternatively, how can one get a free domain name for testing?"),(0,r.kt)("p",null,"Domain names are costly, you might not have one, or not be interested at this time! For this reason, we're going to provide some hints on how to set up a free domain name for your server."),(0,r.kt)("p",null,"There are plenty of free domain server providers, but for this guide, we will opt for ",(0,r.kt)("a",{parentName:"p",href:"https://ngrok.com"},"Ngrok"),". There are other alternatives such as ",(0,r.kt)("a",{parentName:"p",href:"https://localhost.run"},"Localhost.run")," or ",(0,r.kt)("a",{parentName:"p",href:"https://localtunnel.me"},"LocalTunnel.me"),", but we're keeping things simple here and will not try to provide support for anything else. Using an alternative should be quite similar!"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"While ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost.run")," doesn't require you to install any apps, it requires exposing port 22 publicly and some users might not be happy about it.")),(0,r.kt)("p",null,"Bear in mind that the domain address provided by this service changes whenever you restart it! Purchasing a domain is better in the long term (which services like Ngrok also provide), as otherwise, you'd have to modify the configuration every time you restart the server as the domain changes, etc. "),(0,r.kt)("p",null,"With that in mind, let's use ",(0,r.kt)("inlineCode",{parentName:"p"},"Ngrok"),", as a quick demo only!"),(0,r.kt)("p",null,"Visit the ",(0,r.kt)("a",{parentName:"p",href:"https://ngrok.com"},"Ngrok website"),", visit the downloads page and follow the instructions to install it on your operating system. Here's how we'd install it for Linux ",(0,r.kt)("inlineCode",{parentName:"p"},"snap")," package manager users."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"snap install ngrok\n")),(0,r.kt)("p",null,"Or, via Apt"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null && echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list && sudo apt update && sudo apt install ngrok\n')),(0,r.kt)("p",null,"Once installed, you can do a quick check by checking the version:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ngrok --version\n")),(0,r.kt)("p",null,"You should get a response"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ngrok version 3.1.0\n")),(0,r.kt)("p",null,"To create a new domain name via ",(0,r.kt)("inlineCode",{parentName:"p"},"Ngrok"),", use the following syntax:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ngrok http 80\n")),(0,r.kt)("p",null,"The Ngrok process will generate the following output, where you can find the address created (that is publicly accessible) which maps to the server port ",(0,r.kt)("inlineCode",{parentName:"p"},"80"),". Our reverse proxy forwards request to port ",(0,r.kt)("inlineCode",{parentName:"p"},"80")," to our ",(0,r.kt)("inlineCode",{parentName:"p"},"Ursa")," node. Find more about how the services work in the ",(0,r.kt)("a",{parentName:"p",href:"fleek-network-node-health-check-guide"},"Node Health check guide"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"Add Okta or Azure to protect your ngrok dashboard with SSO: https://ngrok.com/dashSSO                                                               \n                                                                                                                                                    \nSession Status                online                                                                                                                \nSession Expires               1 hour, 53 minutes                                                                                                    \nUpdate                        update available (version 3.1.1, Ctrl-U to update)                                                                    \nTerms of Service              https://ngrok.com/tos                                                                                                 \nVersion                       3.1.0                                                                                                                 \nRegion                        Europe (eu)                                                                                                           \nLatency                       14ms                                                                                                                  \nWeb Interface                 http://127.0.0.1:4040                                                                                                 \nForwarding                    https://94e7-159-65-87-194.eu.ngrok.io -> http://localhost:80                                                         \n                                                                                                                                                    \nConnections                   ttl     opn     rt1     rt5     p50     p90                                                                           \n                              0       0       0.00    0.00    0.00    0.00\n")),(0,r.kt)("p",null,"We can conclude that at the time of running, ",(0,r.kt)("inlineCode",{parentName:"p"},"Ngrok")," generated the following domain:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"https://94e7-159-65-87-194.eu.ngrok.io \n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Be aware that this is useful for a quick demo, by stopping the Ngrok process the domain it generates might differ if you are not a paying customer. We have no affiliation with ",(0,r.kt)("inlineCode",{parentName:"p"},"Ngrok")," and you are happy to use whichever domain provider of your liking. We are only using ",(0,r.kt)("inlineCode",{parentName:"p"},"Ngrok")," as a quick example for the users educational interest. If you've been following the guide, should know that the domain name is declared in the reverse proxy configuration file and the Let's encrypt initialisation script, meaning you'd have to update it everytime. In fact, Ngrok forces HTTPS by default, you wouldn't have to set up, but in any case we are not knowledgable with the service it provides and the level of security but its useful for quick demos.")),(0,r.kt)("h3",{id:"how-to-verify-dns-records"},"How to verify DNS records?"),(0,r.kt)("p",null,"Once you have ",(0,r.kt)("a",{parentName:"p",href:"#how-to-set-up-the-dns-settings-for-a-node-server"},"set up the DNS records"),", verify the records are set correctly, for that you can easily run ",(0,r.kt)("inlineCode",{parentName:"p"},"dig")," CLI or website like ",(0,r.kt)("a",{parentName:"p",href:"https://mxtoolbox.com/"},"mxtoolbox"),". As an example, we're going to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"dig")," CLI!"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Dig")," (Domain Information Groper) is a network administration command-line tool for querying the Domain Name System (DNS). Read more about it ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Dig_(command)"},"here"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"dig fleek-network-node.fleek.xyz +nostats +nocomments +nocmd\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},";fleek-network-node.fleek.xyz.      IN  A\nfleek-network-node.fleek.xyz.       484 IN  A   181.196.118.156\n")),(0,r.kt)("p",null,"\ud83d\udc46 The goal is to determine if the DNS record matches the machine IP Address we set up earlier. There might be cases you'll need to wait longer, but it's good to double-check your DNS record dashboard and revise it if the desired settings fail to show!"),(0,r.kt)("p",null,"There are many other tools you can use to verify the DNS records, feel free to pick your favorite!"),(0,r.kt)("h2",{id:"stack-services"},"Stack Services"),(0,r.kt)("p",null,"In our ",(0,r.kt)("a",{parentName:"p",href:"fleek-network-running-a-node-in-a-docker-container"},"Running a node in a Docker container")," guide, we propose a Stack to run the Network Node that offers you a service for:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ursa - The Network Node (Ursa CLI process)"),(0,r.kt)("li",{parentName:"ul"},"Ursa-proxy - A reverse proxy for Ursa Node service"),(0,r.kt)("li",{parentName:"ul"},"Prometheus - A monitoring system for real-time metrics with a web client"),(0,r.kt)("li",{parentName:"ul"},"Grafana - Metric visualization for logs, traces, etc.")),(0,r.kt)("p",null,"This can be fully customized or exchanged for other options for the reverse proxy, monitoring or metric visualization. You are free to pick your tools!"),(0,r.kt)("p",null,"\u26a0\ufe0f We only provide support for ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa"},"Ursa CLI"),", which we are developing. You'll have to visit the official project for more information on how to operate them!"),(0,r.kt)("h2",{id:"ursa-proxy-ssltls-configuration"},"Ursa-proxy SSL/TLS configuration"),(0,r.kt)("p",null,"Our reverse proxy has a ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")," file where the SSL certificate(s) are, or can be configured. We keep the ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")," pre-configured with an example that you can modify with yours."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-toml"},'# Server settings for insecure communication via HTTP\n[[server]]\nproxy_pass = "127.0.0.1:4069"\nlisten_addr = "0.0.0.0:80"\n# Certobot requirement for ACME challenge\n# during the SSL/TLS certificate generation\n# the certbot standalone web server\n# will serve a file in the directory path\nserve_dir_path = ".well-known"\n\n# Server settings for secure communication via HTTPS (SSL/TLS)\n[[server]]\nproxy_pass = "127.0.0.1:4069"\nlisten_addr = "0.0.0.0:443"\n\n[server.tls]\ncert_path = "/etc/letsencrypt/live/YOUR-DOMAIN/fullchain.pem"\nkey_path = "/etc/letsencrypt/live/YOUR-DOMAIN/privkey.pem"\n\n# Admin service.\n# You can omit this section as this is the default.\n[admin]\naddr = "0.0.0.0:8881"\n')),(0,r.kt)("h3",{id:"creating-a-valid-certificate"},"Creating a valid certificate"),(0,r.kt)("p",null,"Certificates can be generated by ",(0,r.kt)("a",{parentName:"p",href:"https://certbot.eff.org/"},"Certbot"),", a free, open-source software tool for automating the use of Let\u2019s Encrypt certificates on manually-administrated websites to enable HTTPS."),(0,r.kt)("p",null,"We provide a ",(0,r.kt)("a",{parentName:"p",href:"https://get.fleek.network/lets_encrypt"},"script")," to handle this for you - install it, run the commands with correct arguments, etc - that can be run as easily as you do for the assisted installer."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"curl https://get.fleek.network/lets_encrypt | bash\n")),(0,r.kt)("p",null,"Alternatively, we describe how to do it manually by following the guide here."),(0,r.kt)("h3",{id:"preparing-the-certbot-initialization"},"Preparing the Certbot initialization"),(0,r.kt)("p",null,"First, check if you already have certbot installed. The certbot documentation suggests uninstalling preinstalled versions and pull the latest version from snap package manager."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"apt-get remove certbot\n")),(0,r.kt)("p",null,"In Ubuntu, you'd start by updating snap package manager."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"sudo snap install core\nsudo snap refresh core\n")),(0,r.kt)("p",null,"Install the certbot cli"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"snap install --classic certbot\n")),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"/snap/bin")," is in the system PATH environment variable, you should be able to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"certbot --version\n")),(0,r.kt)("p",null,"Otherwise, add ",(0,r.kt)("inlineCode",{parentName:"p"},"/snap/bin")," to the PATH, or symlink the certbot binary to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/local/bin"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"sudo ln -s /snap/bin/certbot /usr/bin/certbot\n")),(0,r.kt)("p",null,"Create the ursa-proxy configuration file in the path ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.ursa/proxy/config.toml")," by default the ursa configuration directory is located under ",(0,r.kt)("inlineCode",{parentName:"p"},"/root/.ursa")," but some users customise it to ",(0,r.kt)("inlineCode",{parentName:"p"},"$HOME/.ursa"),"."),(0,r.kt)("p",null,"Here, we create the directory, if one doesn't exist (we'll use the default .ursa location):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mkdir -p /root/.ursa/proxy\n")),(0,r.kt)("p",null,"1) Create a new ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"touch /root/.ursa/proxy/config.toml\n")),(0,r.kt)("p",null,"2) Put the following content in the newly created file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'[[server]]\nproxy_pass = "127.0.0.1:4069"\nlisten_addr = "0.0.0.0:80"\nserve_dir_path = ".well-known"\n\n[[server]]\nproxy_pass = "127.0.0.1:4069"\nlisten_addr = "0.0.0.0:443"\n\n[server.tls]\ncert_path = "/etc/letsencrypt/live/YOUR-DOMAIN/fullchain.pem"\nkey_path = "/etc/letsencrypt/live/YOUR-DOMAIN/privkey.pem"\n\n[admin]\naddr = "0.0.0.0:8881"\n')),(0,r.kt)("p",null,"3) Make sure that you replace the ",(0,r.kt)("inlineCode",{parentName:"p"},"YOUR-DOMAIN")," with your custom domain name in the ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")," file"),(0,r.kt)("p",null,"\ud83d\udca1 A domain name is required to be pointing to your server public IP address, this is used by certbot to create the Let's Encrypt TLS certificates"),(0,r.kt)("p",null,"Here's an example of how the ",(0,r.kt)("inlineCode",{parentName:"p"},"cert_path")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"key_path")," would look like for the hypothetical domain name ",(0,r.kt)("inlineCode",{parentName:"p"},"fleek-network-node.mydomain.com")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")," file settings."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'[server.tls]\ncert_path = "/etc/letsencrypt/live/fleek-network-node.mydomain.com/fullchain.pem"\nkey_path = "/etc/letsencrypt/live/fleek-network-node.mydomain.com/privkey.pem"\n')),(0,r.kt)("p",null,"\ud83d\udca1 We are just showing the two lines and omitting the remaining lines, to keep it short, you should not delete the remaining lines."),(0,r.kt)("h3",{id:"running-the-lets-encrypt-automation-script"},"Running the Let's Encrypt automation script"),(0,r.kt)("p",null,"First, change the directory where you've stored the ursa repository, e.g. by default its located at ",(0,r.kt)("inlineCode",{parentName:"p"},"~/fleek-network/ursa")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"cd ~/fleek-network/ursa\n")),(0,r.kt)("p",null,"The directory file structure should look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},".\n\u251c\u2500\u2500 CODE_OF_CONDUCT.md\n\u251c\u2500\u2500 Cargo.lock\n\u251c\u2500\u2500 Cargo.toml\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 Dockerfile-gateway\n\u251c\u2500\u2500 Dockerfile-proxy\n\u251c\u2500\u2500 LICENSE-APACHE\n\u251c\u2500\u2500 LICENSE-MIT\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 contracts\n\u251c\u2500\u2500 crates\n\u251c\u2500\u2500 doc\n\u251c\u2500\u2500 docker\n\u251c\u2500\u2500 foundry.toml\n\u251c\u2500\u2500 infra\n\u251c\u2500\u2500 remappings.txt\n\u251c\u2500\u2500 rust-toolchain.toml\n\u251c\u2500\u2500 sdk\n\u251c\u2500\u2500 target\n\u251c\u2500\u2500 test-plans\n\u2514\u2500\u2500 test_files\n")),(0,r.kt)("p",null,"We have to provide a domain name, such as the example ",(0,r.kt)("inlineCode",{parentName:"p"},"fleek-network-node.fleek.xyz")," and a valid email address ",(0,r.kt)("inlineCode",{parentName:"p"},"ops@fleek.xyz")," that you as an operator have access to."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"sudo certbot certonly --standalone --preferred-challenges http --email <YOUR-EMAIL-ADDRESS> --domain YOUR-DOMAIN --rsa-key-size 4096\n")),(0,r.kt)("p",null,"Since we have already:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Updated the ",(0,r.kt)("inlineCode",{parentName:"li"},"A Records")," in the ",(0,r.kt)("a",{parentName:"li",href:"#how-to-set-up-the-dns-settings-for-a-node-server"},"previous step")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#how-to-verify-dns-records"},"Verified")," that the DNS records are correct")),(0,r.kt)("p",null,"We can go ahead and execute the command. Here we've replaced the YOUR-EMAIL and YOUR-DOMAIN with our example domain and email addresses."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"sudo certbot certonly --standalone --preferred-challenges http --email ops@fleek.xyz --domain fleek-network-node.fleek.xyz --rsa-key-size 4096\n")),(0,r.kt)("p",null,"If the script is executed successfully, the output should be similar to (have in mind that we are using ",(0,r.kt)("inlineCode",{parentName:"p"},"fleek-network-node.fleek.xyz")," as an example, you should see yours):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"Domains: fleek-network-node.fleek.xyz\nCreating full-node_certbot_run ... done\nGenerating a RSA private key\n...........................................++++\n......................................................................................................................................................................................................++++\nwriting new private key to '/etc/letsencrypt/live/fleek-network-node.fleek.xyz/privkey.pem'\n-----\n\nCreating full-node_certbot_run ... done\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nRequesting a certificate for fleek-network-node.fleek.xyz\n\nSuccessfully received certificate.\nCertificate is saved at: /etc/letsencrypt/live/fleek-network-node.fleek.xyz/fullchain.pem\nKey is saved at:         /etc/letsencrypt/live/fleek-network-node.fleek.xyz/privkey.pem\nThis certificate expires on 2023-04-25.\nThese files will be updated when the certificate renews.\n\nNEXT STEPS:\n- The certificate will need to be renewed before it expires. Certbot can automatically renew the certificate in the background, but you may need to take steps to enable that functionality. See https://certbot.org/renewal-setup for instructions.\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nIf you like Certbot, please consider supporting our work by:\n * Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n * Donating to EFF:                    https://eff.org/donate-le\n")),(0,r.kt)("p",null,"It's a long output but we can find the last few paragraphs useful, where it reads:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"Successfully received certificate.\nCertificate is saved at: /etc/letsencrypt/live/fleek-network-node.fleek.xyz/fullchain.pem\nKey is saved at:         /etc/letsencrypt/live/fleek-network-node.fleek.xyz/privkey.pem\nThis certificate expires on 2023-04-25.\nThese files will be updated when the certificate renews.\n")),(0,r.kt)("p",null,"You may also find that the paragraph after, that mentions that the certificate expires is important. If you are running the Docker Stack we provide, the ",(0,r.kt)("inlineCode",{parentName:"p"},"certbot")," is installed and automates renewing the certification for you."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"NEXT STEPS:\n- The certificate will need to be renewed before it expires. Certbot can automatically renew the certificate in the background, but you may need to take steps to enable that functionality. See https://certbot.org/renewal-setup for instructions.\n")),(0,r.kt)("h3",{id:"how-to-run-a-domain-name-health-check"},"How to run a domain name health check?"),(0,r.kt)("p",null,"As previously instructed in our ",(0,r.kt)("a",{parentName:"p",href:"fleek-network-node-health-check-guide"},"guide"),", we can do a quick health check by making ",(0,r.kt)("inlineCode",{parentName:"p"},"cURL")," requests to our server and reading the response. There's the option to get the response body that should be text ",(0,r.kt)("inlineCode",{parentName:"p"},"pong")," or get some HTTP Headers."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'curl -w "\\n" https://<YOUR DOMAIN NAME>/ping\n')),(0,r.kt)("p",null,"For our example, we have the domain ",(0,r.kt)("inlineCode",{parentName:"p"},"fleek-network-node.fleek.xyz")," and this is how the ",(0,r.kt)("inlineCode",{parentName:"p"},"cURL")," request would look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'curl -w "\\n" https://fleek-network-node.fleek.xyz/ping\n')),(0,r.kt)("p",null,"A successful response should be ",(0,r.kt)("inlineCode",{parentName:"p"},"pong")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"pong\n")),(0,r.kt)("p",null,"Use the flag ",(0,r.kt)("inlineCode",{parentName:"p"},"-I")," to get the HTTP Headers. To learn more read the guide ",(0,r.kt)("a",{parentName:"p",href:"fleek-network-node-health-check-guide"},"here"),"."),(0,r.kt)("p",null,"You can do these tests from any remote location that is not your server or local machine and the health check should pass, as the port should be publicly available to any service on the internet."),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"Congratulations! If you reached this far you have improved the security of your Network Node and helped contribute to a safer Fleek Network!"),(0,r.kt)("p",null,"By providing a brief introduction to SSL/TLS certificates, the reasons why they exist or why you'd want to secure the Network Node, we jumped quickly to the domain name setup. After completing the verification of the DNS records, where our Stack and Node are running from, prepared the ursa-proxy configuration."),(0,r.kt)("p",null,"To complete we verified that our Node is healthy by doing a quick checkup, using one of the options previously discussed in our ",(0,r.kt)("a",{parentName:"p",href:"fleek-network-node-health-check-guide"},"Node health check")," guide. We have then secured the Node!"),(0,r.kt)("p",null,"While we do our best to provide the clearest instructions, there's always space for improvement, therefore feel free to make any contributions by messaging us on our ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/fleekxyz"},"Discord")," or by opening a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fleek-network"},"PR")," in any of our repositories \ud83d\ude4f."),(0,r.kt)("p",null,"Discover more about the project by ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fleek-network/ursa"},"watching/contributing on Github"),", following us on ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/fleek_net"},"Twitter"),", and joining ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/fleekxyz"},"our community Discord")," for all the best updates!"),(0,r.kt)(i.Z,{name:"Helder Oliveira",image:"https://github.com/heldrida.png",title:"Software Developer + DX",url:"https://github.com/heldrida",mdxType:"Author"}))}h.isMDXComponent=!0},1026:(e,t,n)=>{n.d(t,{ZP:()=>i});var a=n(7462),r=(n(7294),n(3905));const o={toc:[]};function i(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},o,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\ud83e\udd16 As Fleek Network's repositories are in constant development and change, you should consider that the following guide was ",(0,r.kt)("a",{parentName:"p",href:"https://git-scm.com/docs/git-checkout"},"checked in")," to commit ",(0,r.kt)("inlineCode",{parentName:"p"},"5a33b7"),". While we try our best to update documentation and guides during development, there might be breaking changes that might take some time to reflect in our docs. To avoid disappointment, feel free to check into commit ",(0,r.kt)("inlineCode",{parentName:"p"},"5a33b7")," or contribute by getting in touch with us, or sending a PR in the relevant context. Learn how to checkout a commit in our repository history ",(0,r.kt)("a",{parentName:"p",href:"../../reference/Git/how-to-checkout-a-commit-in-project-history"},"here")," \ud83d\ude4f.")))}i.isMDXComponent=!0},3872:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294);const r=e=>{let{image:t,name:n,title:r,url:o}=e;return a.createElement("section",{className:"author_card"},a.createElement("div",null,a.createElement("span",{className:"avatar"},a.createElement("a",{href:o,target:"_blank",alt:n},a.createElement("img",{src:t,alt:n}))),a.createElement("div",null,a.createElement("span",{className:"name"},a.createElement("a",{href:o,target:"_blank",alt:n},n)),a.createElement("span",{className:"title"},r),a.createElement("span",{className:"discord"},"Got questions? Find us on ",a.createElement("a",{href:"https://discord.gg/fleekxyz",target:"_blank"},"Discord!")))))}},4456:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294);const r=e=>{let{videoId:t,title:n}=e;return a.createElement("div",{className:"youtube-player"},a.createElement("iframe",{src:`https://www.youtube.com/embed/${t}?controls=1&modestbranding=1&playsinline=1&rel=0`,title:n,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}))}},8557:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/fleek-network-how-to-secure-a-network-node-599a0a1a50d6419c6203571bc1110bc5.png"},8635:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/fleek-network-how-to-secure-a-network-node-599a0a1a50d6419c6203571bc1110bc5.png"}}]);